<!DOCTYPE html>
<html>
  <head>
    <title>Test Mixed Content Blocking</title>
    <link rel="stylesheet" type="text/css" href="style/style.css" />
    <link rel="stylesheet" type="text/css" href="http://cosmin-malutan.github.io/testcase-data/firefox/security/mixed_content_blocked/style/insecure_style.css" />
  </head>
  <body onload="runTests();">
    <div class="test">
      Secure iframe:
      <iframe id="frame" src="iframe.html"></iframe>
    </div>

    <div class="test">
      Insecure script 1: <span id="result1">did not load</span>
    </div>

    <div class="test">
      Insecure script 2: <span id="result2">did not load</span>
    </div>

    <div id="plugintest" class="test">
      Insecure plugin content: <span id="result3">did not load</span>
    </div>

    <div class="test">
      Insecure stylesheet: <span id="result4">did not load</span>
      <span id="styletest">test</span>
    </div>

    <pre id="log"></pre>
    <script>
      function log(s) {
        var log = document.getElementById("log");
        log.textContent = log.textContent + s + "\n";
      }

      // Test 1:
      // load the first insecure script after 1 second so we can test what
      // happens when the MixedContentBlocked happens in a background tab
      log("Attemping to load insecure script 1.");
      var s = document.createElement("script");
      s.src = "http://cosmin-malutan.github.io/testcase-data/firefox/security/mixed_content_blocked/scripts/script1.js";
      document.body.appendChild(s);

      // Test 2:
      // load the second insecure script
      log("Attemping to load insecure script 2.");
      var s = document.createElement("script");
      s.src = "http://cosmin-malutan.github.io/testcase-data/firefox/security/mixed_content_blocked/scripts/script2.js";
      document.body.appendChild(s);

      // Test 3:
      // load an insecure "plugin"
      log("Attempting to load insecure <object> element");
      var o = document.createElement("object");
      o.type = "text/html";
      o.data = "http://cosmin-malutan.github.io/testcase-data/firefox/security/mixed_content_blocked/scripts/object.html";
      document.getElementById("result3").appendChild(o);

      // Test 4:
      // check if the insecure stylesheet loaded
      log("Checking insecure stylesheet status");
      var t = document.getElementById("styletest");
      var c = window.getComputedStyle(t, null);
      if (c.getPropertyValue("color") == "rgb(255, 0, 0)") {
        var r = document.getElementById("result4");
        r.textContent = "LOADED";
        r.parentElement.className = "test fail";
      }
    </script>
  </body>
</html>
